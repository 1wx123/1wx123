# 汇编

## 基础知识  

![组成](pic\组成.png)  





# 微机  

>三种技术:  
(a)存储器技术  
(b)数据传输接口技术  
(c)总线技术  

“工程”观点  

## 1.1 微型计算机概述  

1. 微型机特点  

![微机特点](pic\微机特点.png)   

1971年第一代微型计算机  

## 1.2 

![规模分类](pic\规模分类.png)  

2.按微处理器字长 

>位是计算机内部数据储存的最小单位

>字节(Byte、B)是计算机中数据处理的基本单位
>> 一个字节是8位bit,也就是一位16进制数

>计算机进行数据处理时，一次存取、加工和传送的数据长度称为字（word）。

>8个位 (bit、b) 称为一个字节 (byte) ，两个字节称为一个字 (Word)

>在存储器中，通常每个单元存储一个字，因此每个字都是可以寻址的。字的长度用位数来表示。

>在计算机的运算器、控制器中，通常都是以字为单位进行传送的。

字长:计算机的每个字所包含的位数称为字长

在信息处理中，一群字作为一个单元来处理的称为“字块”  

## 1.3 微处理器、微型计算机和微型计算系统  

![三者关系](pic\三者关系.png)  

微处理器就是CPU  

### 1.3.1 微处理器(CPU)  

1. CPU功能  

![CPU功能](pic\CPU功能.png)

注意它可以存储少量数据  

2. CPU在内部结构上包含下面这些部分  

![CPU内部结构](pic\CPU内部结构.png)  
> 1. 算术逻辑部件  
>> 可以进行加减乘除算术运算和与或非异或等逻辑运算  
> 2. 累加器和寄存器  
>> 寄存器包括通用寄存和专用寄存  
累加器也是通用寄存器      

>专用寄存器都是为指令而执行而设置的，包括程序计数器、堆栈指针、标志寄存器等。  

>3. 控制器是CPU的控制中心，在指令执行过程中，控制器按照指令的功能发控制命令。  
>> 由指令寄存器、指令译码器、时序和控制电路，以及中断机构构成  
>> 指令寄存器存放当前正在执行的指令，指令译码器对指令进行译码
>> 中断机构是用来处理计算机运行过程中出现的异常事件和外部对计算机发出的请求  

微处理器的控制信号:两类  

1) 通过对指令的译码、由CPU内部产生的，这些信号由CPU送到存储器、输入输出接口电路和其他部件；
2) 微型机系统的其他部件送到CPU的，通常用来向CPU发出请求，如中断连接、总线请求  




微处理器内部的总线叫内部总线(片内总线)  

外面的叫系统总线  

3. CPU外频，主频，倍频  

- CPU外频
由主板为CPU提供的基准时钟频率，亦即系统总线频率  

- CPU主频  
也叫工作频率，是CPU内核电路的实际运行频率。主频是CPU的主要特征，是CPU内核运行时的时钟频率，它的高低直接影响CPU的运算速度。  

- 关系  
主频=外频x倍频  

### 1.3.2 微型计算机(主机)  

![微型计算机结构](pic\微型计算机结构.png)  

![存储地址](pic\存储地址.png)  

3. 输入/输出(I/O)接口电路  
![接口端口](pic\接口端口.png)

4. 系统总线  

在微型系统的不同层次结构中，有不同的总线。和CPU直接相连的总线称为CPU总线。  

>CPU总线按不同功能分为:  
(1)数据总线DB(data bus):传输数据信息  
>> a) "数据"是广义的:一般意义上的数据、指令代码、状态量、控制量  
b)双向的  
c)位宽(宽度)  

(2)地址总线AB(address bus):传送地址信息  

>>a)单向的  
b)位数决定了CPU可以直接寻址的内存范围:
![寻址地址范围](pic\寻址地址范围.png)

1G=10^9

(3)控制总线CB(control bus):传输控制信号  
>>a)双向的  
b)包括读/写控制信号等等  

### 1.3.3 微型计算系统(通常意义上的微型计算机)  

1. 系统软件  
2. 应用软件  
3. 外部设备  

## 1.4 微型计算机的应用  

1. 科学计算  
2. 信息处理  
3. 过程控制  
4. 仪器、仪表控制  
5. 家用电器和民用产品控制  

## 1.5 微型计算机的性能指标  

1. CPU的位数、主频、核心数  
2. 内存容量和速度  
3. 硬盘的类型、容量和速度  
4. 显卡GPU速度和显存大小  
5. 主板制作工艺  

# 2、16和32位微处理器  

![](pic/8086编程结构.png)

![](pic/BIU和EU.png)

![](pic/BIU的4个段地址寄存器.png)  

![](pic/地址加法器.png)  

![](pic/EU中的4个通用数据寄存器.png)

累加器（Accumulator）的名称来源于其最初的设计用途，即用于累积（积累）结果。在早期的x86处理器中，AX通常用于执行算术运算，如加法、减法和乘法。因此，它的名称强调了它在这些操作中的重要性。累加器通常用于临时存储计算的中间结果，并且可以将结果累积到累加器中，以便后续的运算。  

随着x86处理器的发展，其他通用寄存器如BX、CX和DX也被引入，并且它们也可以用于各种算术和逻辑操作。但是，AX仍然保留了其累加器的名称，并且可以看作是最常用于累积操作的通用寄存器之一。  

在早期的x86编程中，BX常用于基址偏移计算，特别是在寻址内存时。它也可以像其他通用寄存器一样用于算术和逻辑操作。  

loop循环时要进行两步操作  

1) (cx)=(cx)-1;  
2) 判断cx中的值不为零则转至标号处执行程序  

![](pic/4个专用寄存器.png)

![](pic/FLAGS两类.png)

![](pic/状态标志_1.png)  

![](pic/状态标志_2.png)  

![](pic/控制标志.png)

### 三、总线接口部件BIU和执行部件EU的动作管理  

> 两个部件相互独立，并行工作，分别完成各自搞作。  

> 两个部件相互配合，按照一定的规则，实现指令取指和执行的流水线操作。  

EU和BIU两个独立单元，可以独立完成指令和总线操作任务，及两个单元可重叠的同时工作。  

***流水线***：就是两次或多次重叠工作  

![](pic/8086之前的处理器与8086处理器执行过程对比.png)  

### 四、总线周期  

> 时钟周期  
> ***总线周期(重点)  ***
> 指令周期    
#### (1)时钟周期  

相邻两个时钟脉冲上升沿(下降沿)之间的时钟间隔称为时钟周期(Clock Cycle),也称为T状态(Time-State)  

由计算机的主频决定(主频的倒数)，是总线操作的最小时间单位  

#### (2)总线周期  

8086CPU通过总线对外部内存(存储器或I/O接口)进行一次访问所需要的时间称为一个总线周期  

![](pic/总线操作.png)  

在8086/8088CPU中，CPU与内存或接口间进行通信，如将一个字节写入内存一个单元(或接口)，或者从内存某单元(或某接口)读一个字节到CPU，这种读(或)写的过程称为一个总线周期。

#### (3)指令周期  

CPU从内存取一条指令并执行该条指令所用的时间  

不同指令的指令周期长度不同  

CPU每执行一次指令，至少要通过总线对存储器访问一次(取指令)，所以指令周期至少包含一个总线周期  
当然，一个指令周期也可以包含若干个总线周期  

![](pic/总线周期包含4个时钟周期.png)  

![](pic/T1~T4.png)  

注意T2状态高四位和低四位的分工  

等待时钟周期Tw  
> 在T3和T4之间插入若干个附加时钟周期，称为等待时钟周期Tw  

> ![](pic/判断是否插入Tw.png)  

![](pic/等待状态.png)  

注意在READY发送"准备好"信号，CPU收到信号后，会完成该时钟周期完成数据传输，数据传输完成后，会自动脱离Tw状态，进入T4状态  

空闲状态Ti(idle state)  
> 当指令队列满，且EU无总线请求时，CPU的BIU进入空闲状态Ti  

空闲状态出现在两个相邻的总线周期之间  

### 2.1.2 8086的引脚信号和工作模式  

一、8086的工作模式  

8086微处理器有两种工作模式:  

> 最小模式(最小组态、单处理机模式)  

> 最大模式(最大组态、多处理器系统)  

1.最小系统  

8086CPU直接产生系统所需要的全部控制信号，系统中的总线控制逻辑电路也被减少到最少，因此系统很简单  

![](pic/数据传送指令.png)  

2.最大模式  

该系统除了8086主处理器外，一般还有一个或多个协处理器  

特点: 8086和总线控制器8288共同形成总线信号  

系统结构复杂，数据处理能力增强，速度有所提高  

8288作用:对8086发出的状态信号进行译码产生相应控制信号(读/写控制信号、对地址锁存器8282和总线驱动驱动器8286的控制信号等)  

![](pic/最大模式结构.png)  
![](pic/与8086系统的连接.png)  
8086的工作模式:  

有硬件连线来确定，具体说就是利用MN/MX八接高电平+5V为最小模式，接0为最大模式  

二、8086的引脚信号和功能  

![](pic/各级总线.png)  

注意  

> 引脚的功能
> 信号的流向  
> 有效电平  
> 三态能力

8086 40个引脚直插式封装  

为减少引脚，采用分时复用的地址/数据、地址/状态总线，因而部分引脚有两种功能  

![](pic/8086引脚图.png)  

1.共用引脚信号和最小模式的引脚信号  

(1)数据和地址引脚
(2)读写控制引脚  
(3)中断请求引脚和响应引脚  
(4)总线请求和响应引脚  

(1)数据和地址引脚  

$AD_15~AD_0$(Address/Data)
-地址/数据分时复用引脚、双向、三态  

> 在访问存储器或外设的总线操作周期中，这些引脚在第一个时钟周期输出存储器或I/O端口的低十六位地址$A_15~A_0$  

$A_19/S_6~A_16/S_3$(Address/Status)  

- 地址/状态分时复用引脚，输出、三态  

***8086可用20位地址寻址1MB的内存空间***

> 这些引脚在访问存储器的第一个时钟周期输出高4位地址$A_{19}~A_{16}$  

> 在访问外设的第一个时钟周期全部输出低电平无效  

> 其他时间输出状态$S_6 $~ $S_3$  

>> $S_6$：为低电平，表示8086与总线相连。  

>> $S_5$:表示中断允许标志的状态。当IF=1时，$S_5$置1，当IF=0时$S_5$清零  

>> $S_4和S_3$:指示是哪一个段寄存器正在被使用。  

>> $S_4S_3$=00表示CPU当前使用ES  
>> 01表示CPU当前使用SS,  
>> 10表示CPU当前使用CS或未用，    
>> 11表示CPU当前使用DS    

注意AD_0  

--低8位数据的选通信号  

> CPU的传输特性决定了:只要是和偶地址传输数据,则CPU必定通过总线的低8位(AD_7~AD_0)来传输数据  

### 微机计算机系统的内部组织  

16位CPU用20位地址总线寻址1MB存储空间，首地址为00000H，末地址为FFFFFH。  

整个从存储器由两个512KB的存储体组成，一个为奇地址存储体，因为其数据线与数据总线的高8位相连，所以也称为高字节存储器；另一个为偶地址存储体，因为其数据线与数据总线的低8位相连，所以也叫作低字节存储体。  

存储器访问时分为:字节和字型  

按字节访问可以只访问奇地址，也可只访问偶地址存储器  


$\overline{BHE}$：作为体选信号连接奇地址存储体

当
> A_0、
$\overline{BHE}$为01，按字节访问偶地址，数据在D_7~D_0传输，为10时，按字节访问奇地址存储体数据在D_17~D_8传输，为00时，按字访问两个存储体，数据在D_15~D_0传输，都为1时，不能访问任何一个存储体,为空闲状态    

按字访问时，有对准和非对准状态，  

字的对准状态要求起始地址为偶地址。在对准状态下，A_0和
$\overline{BHE}$都为0，一个总线周期即可通过D_15~D_0完成16位的字传输  

在·非在对准状态下，要两个总线周期才能晚上成一个字型数据传输，先访问奇地址  

在T_1状态，AD_0输出低电平，表示在T_2、T_3、T_4状态，低8位数据线上的数据有效  

(2) 读写控制引脚  

$M/\overline{IO}$（Memory/Input and Output）  

--存储器或I/O访问，输出、三态  

> 输出高电平时，表示CPU将访问存储器，这时地址总线A_19~A_0提供20位存储器地址
> 该引脚输出低电平时，表示CPU将访问I/O端口，这时地址总线A-15~A-0提供16位I/O端口地址  

![](pic/读写.png)  

以CPU为视角  

![](pic/读写MIO.png)  

![](pic/ALE.png)

地址锁存器8282  

![](pic/DEN和DT%20R.png)  

都是8086送给8286  

![](pic/READY.png)  

在T_3前沿检测  

![](pic/BUSHE.png)  

(3)中断请求和响应引脚

![](pic/中断请求和响应引脚.png) 
不受IF影响  


![](pic/可屏蔽中断.png)   

每个指令周期的最后一个T状态(相邻两个时钟脉冲上升沿(下降沿)之间的时钟间隔称为时钟周期(Clock Cycle),也称为T状态(Time-State))对其采样  



![](pic/可屏蔽中断响应.png)  

(4) 总线请求和响应引脚  
![](pic/总线保持.png)  

总线请求设备(CPU之外的主模块)向CPU申请使用总线

此时CPU使地址/数据总线和控制/状态线处于浮空状态(高阻)  

![](pic/HLDA.png)  

(5)其他引脚  

![](pic/其他引脚.png)  

![](pic/CLK.png)  
要求1/3为高电平  

![](pic/Vcc.png)  

![](pic/TEST.png)  
与WAIT指令配合使用  

2. 最大模式引脚信号  

![](pic/最大与最小引脚区别.png)  

总线周期状态(bus cycle status)信号 S0、1、2  

CPU送给总线控制信号8288的状态信号  

![](pic/8288结构框图.png)

![](pic/S012.png)  

![](pic/指令状态信号.png)  

8087协处理器  

![](pic/CLK.png)  

与HOLD对比  

![](pic/RQ.png)  
这两个引脚用于输入总线请求信号和输出总线允许(授权)信号  

相当于最小模式的HOLD

![](pic/RQ1.png)  

相当于最小模式的HLDA  


![](pic/RQ2.png)  

三、 8086最大、最小模式的典型配置  

1. 最小模式的典型配置  

    - 8086CPU
    - 时钟发生器8284X1  
    - 地址锁存器8282X3
    - 总线收发器8286X2

![](pic/8282.png)  
8282 地址锁存器  


8086地址线/数据线/状态线分时复用  
在T1状态将地址锁起来  

![](pic/82828位三态透明锁存器.png)  

![](pic/82821.png)  

![](pic/8282与8086连接.png) 重点  
![](pic/8282电路.png)  

总线收发器8286  

8286是8位三态双向缓冲器  
![](pic/8286电路.png)  
- 有8路双向缓冲电路，可是实现8位数据的双向传送  
- 输出与输入同相

T控制数据流向  

![](pic/8086与8086连接.png)

![](pic/8286连接图.png)  

DT/R把(Data transmit/receive)

![](pic/DEN何时才能为有效低电平.png)  

![](pic/DTR的状态.png)  

![](pic/时钟发生器8284.png)  

![](pic/处理时钟信号的输出端.png)  

![](pic/最小模式的典型配置.png)  

2. 最大模式的典型配置  
![](pic/最大模式的典型配置.png)  

![](pic/8288.png)  

![](pic/8288引脚图.png)   

![](pic/8288结构框图.png)  

![](pic/总线命令信号1.png)  

![](pic/总线命令信号2.png)  

![](pic/控制逻辑.png)  

![](pic/控制逻辑1.png)  

![](pic/控制逻辑2.png)  

![](pic/控制逻辑3.png)  


![](pic/控制信号发生.png)  


![](pic/控制信号发生1.png)  

最大模式和最小模式/DEN信号相反  



![](pic/8288连接.png)  

### 2.1.3 8086的操作和时序  

![](pic/掌握时许的重要性.png)  

#### 一、系统复位操作的总线周期  

![](pic/总线周期1.png)  

![](pic/)

![](pic/系统复位操作.png)  

![](pic/当REST有效后.png)  


#### 二、读/写操作的总线周期  

![](pic/存储器读总线周期.png)  

![](pic/T11.png)  

![](pic/T21.png)  

![](pic/T31.png)  

![](pic/存储器读.png)  

![](pic/最小模式存储器写.png)  

![](pic/存储器读写不同点.png)  

![](pic/最小模式IO读.png)  

![](pic/最小模式IO写.png)  

与寄存器不同T1高四位为无效电平  

![](pic/最大模式总线周期.png)  

![](pic/最大模式读.png)  

![](pic/最大模式写.png)  

![](pic/最大读.png)  

![](pic/最大写.png)  

![](pic/最大不同点.png)  













三、中断响应总线操作的总线周期  

![](pic/中断的概念.png)

![](pic/中断类型.png)  

中断系统 256(0~255)中断类型码  

    软件中断
    硬件中断  

![](pic/中断分类.png)  

8259A：中断控制系统  

(1)硬件中断  

由外部硬件产生，称为外部中断。  

8086为外部中断提供了两条硬件中断信号线，即NMI和INTR，分别接收***非屏蔽中断***和***可屏蔽中断***请求信号  

NMI(非屏蔽中断)：不受中断允许标志IF的限制，其中断类型为码为2.当NMI引脚上出现上升沿触发时，表示非屏蔽中断信号有效，CPU会把该信号锁存起来，但要求该信号的有效电平持续两个时钟周期以上  

INRT(可屏蔽中断):高电平触发，可屏蔽中断受中断标志IF的影响。只有在IF=1的情况下，CPU才会在执行当前指令后响应可屏蔽中断请求信号，IF=0,CPU不会响应，也就是终端被屏蔽  

所以CPU无论收到什么类型的中断都会执行完当前指令后后才会进入相应的中断

在实际系统中， 非屏蔽中断通常用来处理系统中出现的重大事故和紧急情况， 如系统掉电处理、紧急停机处理等。

![](pic/软件中断.png)  

0号中断  

除数为0或商超过了寄存器所能表达数的范围，优先级最高的内部中断  

![](pic/1号中断.png)  

80x86指令系统中没有设置或清除TF标志的指令  

![](pic/3号中断.png)  

2号中断:非屏蔽中断

![](pic/4号中断.png)  

![](pic/n型中断.png)  

![](pic/内部中断注意.png)  

#### 3.中断向量  

![](pic/中断向量.png)  

![](pic/中段向量.png)  

中断向量地址指针=4x中断类型码  

#### 4.中断响应过程和时序  

(1)中断类型码的获取方式  

![](pic/获取软件中断.png)  

硬件中断
    1) 不可(非)屏蔽中断:  

    当CPU采样到非屏蔽中断请求时，自动提供中断类型码2，然后根据中断类型码查到中断向量表指针  

    2) 可屏蔽中断:通过中断响应周期来获取中断类型码
![](pic/可屏蔽中断.png)   

![](pic/中断响应总线周期.png)

![](pic/可屏蔽中断的响应过程.png)  

现场保存  

- 响应过程是由系统硬件自动完成的  

- 响应过程是由CPU执行相应的总线周期来实现的  

![](pic/中断响应7个总线周期.png)  

    3) 可屏蔽中断的处理过程  

![](pic/可屏蔽中断的处理过程.png)    

![](pic/中断优先级.png)  

#### 四、总线请求和响应操作的总线周期  

![](pic/最小模式的总线保持.png)  
所有三态输出都进入到高阻状态  

![](pic/总线返回最小.png)  

![](pic/最大模式的总线保持.png)  

![](pic/最大总线保持二.png)  

在两个时钟周期后才能获得总线控制权  

![](pic/总线响应信号条件.png)  


### 2.1.4 8086的存储器编址和IO编址  

段寄存器  

CS  
DS  
SS  
ES  

1. 8086的存储器编址  

![](pic/存储器编址.png)  

![](pic/物理地址的形成.png)  

![](pic/物理地址算法.png)  

![](pic/段寄存器的使用.png)  

2. 8086的IO编址  

![](pic/IO的编制方式.png)  



# 3.Pentium 的指令系统  

![](pic/指令的基本结构.png)      



OPdata: 目的操作数，源操作数  

## 3.1.1 立即数寻址 Immediate Addressing  

mov ax,1000H

## 3.1.2 寄存器寻址 Register Addressing  

mov ax,bx  

寄存器寻址操作在CPU中不需要总线周期，速度快  

也可对源操作数寻址

## 3.1.3 输入/输出端口寻址  

in  

out

有直接寻址和间接寻址两种  

> 直接寻址  
I/O端口的地址直接在指令中给出

寻址范围:00H--FFH(0--255)  8位

> 间接寻址  
I/O端口的地址在寄存器DX中  

寻址范围0~65635 00H--FFFFH 16位

## 3.1.4 存储器寻址  

![](pic/存储器寻址.png)  

![](pic/EA完整格式.png)

基址:基址寄存器BX，任何通用寄存器(AX,BX,CX,DX)都可以作为基地址寄存器,BP也是，一般用BX或BP    
变址寄存器:除SP以外，其他专用基本都可以，一般是DI,SI

### 1.直接寻址  

![](pic/直接寻址.png)  

### 2.寄存器间接寻址  

![](pic/间接寻址.png)  

BP\SP操作数默认存放在堆栈段SS区域  

其他寄存器默认在DS区  

### 3.寄存器相对寻址  

![](pic/相对寻址.png)  

格式: mov ax,disp[bx]
      mov ax,[bx+disp]


### 4.基址加变址寻址  

![](pic/基址加变址寻址.png)  

### 5.相对的基址加变址寻址  

EA=基址+变址+位移量

### 6.相对的带比例因子的变址寻址  

EA=变址X比例因子+位移量  

### 7.基址加比例因子的变址寻址  

EA=基址+变址X比例因子  

### 8.相对的基址加比例因子的变址寻址  

EA=基址+变址X比例因子+位移量

### 9.隐含寻址  

操作数的地址隐含在指令操作码中的寻址方式称为隐含寻址
## 3.2Pentium的指令系统  

### 3.2.1 数据传送指令  

![](pic/数据传送指令.png)  

#### 1.通用传送指令  

目的操作数不能是立即数  

![](pic/Mov的数据传送方向.png)

1. 在CPU各内部寄存器之间传送数据  
通用寄存器  

2. 立即数传送至CPU的通用寄存器(即AX，BX，CX,DX,BP,SP,SI,DI)

3. CPU内部寄存器(除了CS和IP以外)与存储器(所有寻址方式)之间的数据传送  

CS和IP用jmp赋值  


> a.在CPU的通用寄存器和存储器之间传送数据  

> b.在CPU段寄存器与存储器之间传送数据  

mov ds,data[si+bx]

4. 立即数传送至存储器。  

mov [1000H],9  是错误的，因为源操作数和目的操作数的数据类型都不确定  

应修改为  

mov byte ptr [1000H],9 或  
mov word ptr [1000H],9

[1000H]既可以是一个字节型也可以是一个字型，因为字型也可以用小地址的代指  

ptr是综合运算符与byte,word,dword连起来使用，指定存储单元的数据类型

![](pic/mov注意.png)
![](pic/Mov的数据传送方向.png)


> movzx 和 movsx  

movzx EAX,BL     ;80H零扩展为00000080H
movsx EAX,BL     ;80H被符号扩展为FFFFFF80H

#### 2.堆栈操作指令  

堆栈是内存中的一个特定区域，用于存放CPU暂时不使用，但又必须保存的数据  

存储单元地址由(SS:SP)来决定  

堆栈操作具有"先进后出，后进先出"的特点  

![](pic/堆栈格式.png)  

![](pic/堆栈注意.png)  


堆栈成组操作指令  

PUSHA/POPA  
PUSHAD/POPAD  

PUSHA指令就以将8个16位通用寄存器的内容按AX、CX、DX、BX、SP、BP、SI、DI的次序推入堆栈，堆栈指针减16  

这是栈顶单元为DI的低八位  

也就是低地址在栈顶  

栈空时栈指针指向栈空间最高存储单元下一个单元  

其中进栈的SP内容是堆栈操作前的值  

PUSHAD是32位的  

#### 3.交换指令XCHG/BSWAP  

格式:XCHG OPRD1,OPRD2  
![](pic/交换指令XCHG.png)  

相互交换  

![](pic/BSWAP.png)  

寄存器内部字节交换，从而实现换序  

#### 4.输入/输出

输入指令的一般格式为:  

    IN ACC,PORT  

    OUT PORT,ACC  

(1)直接寻址  

(2)寄存器间接寻址  

![](pic/IO寻址注意.png/)  

#### 5.换码指令XLAT  

格式:XLAT(Translate Byte to AL)  

![](pic/换码指令.png)  

![](pic/显示2的程序.png)  

![](pic/地址传送指令.png)  

![](pic/LDS示例.png)

![](pic/LES指令.png)  

![](pic/标志传送指令.png)  

![](pic/读写标志寄存器.png)

![](pic/标志入栈.png)  

![](pic/标志位出栈.png)  

入、出栈指令常成对使用，分别用于子程序和中断服务程序首尾，保护和恢复主程序的各个标志位  

![](pic/标志位堆栈例子.png)  

### 3.2.2 算术运算指令  

SRC：立即数、通用寄存器、存储器  

DST：通用寄存器、存储器  

#### 1.加法指令

    （1）ADD OPRD1,OPRD2  
    不带进位操作数相加
    对6个状态标志OF、SF、ZF、AF、PF和CF都会产生影响  
    (2)ADC OPRD1,OPRD2  
    完成带进位(CF)的两个操作数相加，结果送至OPRD1
![](pic/实现两个双字的带进位加法.png)

CLC清进位标志(CF=0)
![](pic/XADD指令.png)  

![](pic/INc.png)  

![](pic/INC不影响CF.png)


#### 2.减法指令  

    (1)SUB
    (2)SBB(subtract with borrow):与ADC类似还应减去进位标志CF
    (3)DEC OPRD  与inc 类似  

    (4)NEG OPRD  
![](pic/NEG指令.png)  
    (5)比较指令CMP
![](pic/CMP指令.png)  

    (1)比较指令可以用于累加器与立即数、通用寄存器或内存操作数之间比较
    (2)用于其他寄存器与立即数、别的寄存器或任一内存操作数之间的比较  

    (3)通过ZF标志位判断两个数的大小
![](pic/CMP比较大小.png)  

![](pic/比较并交换指令CMPXCHG.png)  

执行后zf=0,(al)=22h,(bl)=24h

![](pic/CMP比较1.png)

![](pic/8字节比较.png)  

#### 3.乘法指令  

(1)无符号数乘法指令MUL  

    MUL OPRD  

OPRD为源操作数  

AL x OPRD =AH|AL OPRD为8位  

AX x OPRD =DX|AX  OPRD为16位  

在x86中操作数不能是立即数，只能是寄存器或存储器操作数，如果被乘数立即数，要先放在acc中  

(2)带符号数乘法指令IMUL  

要求两个乘数都是有符号数  

结果放在AX或DX：AX寄存器对中  

#### 4.除法指令  

(1)无符号数除法

AH|AL / OPRD = AH|AL OPRD为8位  AH为余数 AL为商

DX|AX / OPRD = DX |AX  OPRD16位 DX余数 AX商

![](pic/字除以字.png)  

CWD 将AX寄存器中的16位整数符号扩展为DX:AX寄存器对中的32位整数，保持其有符号性质  

(2)带符号除法指令IDIV  

余数符号与除数相同  

#### 5.类型转换指令CBW/CWD  

(1)字节扩展指令CBW  

![](pic/CBW指令.png)  

![](pic/字扩展指令CWD.png)  

#### 6.十进制调整指令

![](pic/十进制调整指令.png)  

十进制数在机器中以二进制编码的十进制数形式(BCD码)表示  

### 3.2.3 逻辑运算和移位指令  

1.逻辑运算指令AND、OR、NOT、XOR、TEST
逻辑运算指令，按位进行逻辑运算，和算术运算的最大区别就是不进位  



(1)AND 与运算  

与运算的两个操作数不能同时为存储器操作数  
AND指令常用来对某些位清0(与0相"与")的同时保持其他位不变(与1相"与")

![](pic/AND编码格式.png)

(2)OR 指令  
通常用来对指定位置1(与1相"或")的同时保持其他位不变(与0相"或")

(3)NOT 指令

对操作数进行求反操作，然后将结果送回  

(4)XOR 指令

XOR指令常用来取反某些位(与1"异或")的同时保持其他位不变(与0相"异或")



(5)TEST指令  

一般格式 TEST OPRD,im ;im是立即数  
只影响ZF等标志位，即TEST指令不改变操作数的值,把OF和CF标志清0,修改SF、ZF和PF标志。  


比如，用TEST指令检测AL最低位是否为1，则运行

TEST AL,01H

![](pic/TEST指令.png)  

再例如，若要检测AL中的最低位是否为1，且若为1则转移。再这种情况下可以用如下指令:  

TEST AL,01H
JNZ THERE

THERE: MOV BL,05H

2. 移位指令  

    ![](pic/移位指令.png)  

    (1) 非循环移位指令  

![](pic/非循环移位指令.png)  

如果移位次数CNT=1,可以在指令中直接给出，如果大于1，则要用CL给出。

![](pic/移位指令对标志位的影响.png)  

(a)SAL/SHL指令  

算术左移和逻辑左移完全一样(指令的编码格式也完全一样)，每移位一次在右面最低位补一个0，而左面的最高位移入标志位CF。如果最高位和CF不同，则溢出标志OF置1，  

(b)SAR指令  

![](pic/SAR指令.png)  

SAR指令影响标志位CF、OF、PF、SF和ZF

(c)SHR指令  

![](pic/SHR指令.png)  

(2)循环移位指令  

![](pic/循环移位指令.png)  

影响标志位OF和CF

如果移位操作后CF与原来不同则OF=1，
以左移为例，可根据OF判断循环左移操作是否造成了溢出

### 3.2.4 串操作指令

"字符串":指一个数据块或多个字符的集合，简称"串"(String)

#### 串操作指令采用隐含寻址方式  

![](pic/串隐含寻址方式.png)  

修改方向由方向标志位DF决定  

![](pic/串DF.png)  

![](pic/串重复指令.png)  

#### 1.MOVSB/MOVSW/MOVSD  
用于内存区之间字符串、字串或双字串的传送  
字符串传送指令是唯一的源操作数和目的操作数都在存储器中的传送指令  

几个例题

![](pic/实例1.png)  

CLD 置DF为0，使SI、DI按增量方向修改  

#### 2.串比较指令CMPSB/CMPSW  

串比较指令(Compare String),常用于内存之间的数据、字符等比较  

![](pic/串比较.png)  

仅根据指令执行情况设置标志寄存器(尤其是ZF位)，相同则为0

![](pic/例2.png)  

![](pic/例21.png)  

DF=0是SI、DI按增量方向修改

PERE 终止的条件是ZF=1,或CX=0;  

#### 3.串扫描指令SCASB/SCASW

(Scan String)字符串检索(扫描、搜索)指令，用于寻找内存区中指定地数据和字符  

![](pic/串扫描.png )


![](pic/例三.png)

#### 4.取串LODSB/LODSW

(LOad String)取字符串指令  

取到AL或AX里  

TEST 是AND操作

CMPSW是减操作  

#### 5.存串STOSB/STOSW  

(Store String) 存字符串指令  

### 3.2.5 程序控制指令  

1. 转移地址的寻址方式  


(1)段内直接转移  

JMP DISP 

DISP 8位位短转移SHORT  

16位为近转移NEAR  

EA=IP+DISP

(2)段内间接转移  

JMP CX

(3)段间直接转移  

JMP FAR PTR ADDR  






2. 子程序调用和返回  

(1) 子程序调用CALL







### 3.3.2 标记

标记:标识符、保留字、分届符、注释  

### 3.3.3 表达式  

1.操作数  

1) 常量  

字符和字符串用单引号括起来  

2) 变量  

存放在存储单元的数，在程序运行时随时改变  

> 定义变量就是给变量分配存储单元  
> 起一个名字，并赋初值  
>定义变量是由为指令完成的  

![](pic/变量的三种属性.png)  

3) 标号  
标号是指令性语句的符号地址，是转移指令和调用指令的目的地址  

标号和变量一样都是存储单元的地址  
标号对应的存储的单元中存放的是指令  
变量的是数据  

2. 运算符  

1) 算术运算符  
![](pic/算术运算符.png)

2) 逻辑运算符  

3) 关系运算符    

    ![](pic/关系运算符.png)

4) 分析运算符  
![](pic/分析运算符.png)

A.取值运算符SEG和OFFSET  

B.TYPE  

![](pic/TYPE.png)

(5)综合运算符  


## 4.存储器、存储管理和高速缓存  

### 4.1.1 存储器的分类  

1. 内部存储器

2. 外部存储器  

### 4.1.2 内存行列结构  

字节存储机制  

采用矩阵排列形式，目的是为了节省译码电路

![](pic/1024地址线.png)  

![](pic/内存矩阵.png)  

### 4.1.3 选择内存器的考虑因素  

介质分:  

- 磁存储器  
- 半导体存储器  
- 光存储器  

1. 易失性：电源断开后，存储器的内容是否丢失，分为

易失(RAM)和非易失性(ROM)存储器  

2. 只读性：能否用通常的办法来重写或改写  

ROM(只读)

可读可写(RAM和按序存取，磁带)

一般来说内存是RAM

3. 存储容量  

4. 速度：用访问时间来衡量  
TTL存储器：速度快，功耗大，价格贵

MOS存储器:速度慢，功耗小，价格低  

5. 功耗  

### 4.1.4 随机存取存储器RAM

结构和原理分:  

- 静态RAM(SRAM，Static RAM)

片容量小，功耗大，速度快，不断刷新  

- 动态RAM(DRAM,Dynamic RAM)

片容量高，功耗小，速度慢，需要刷新  

### 4.1.5 只读存储器ROM   

![](pic/只读存储器ROM.png)  

写入方法分:

分为如下五种:

(1) 掩模型ROM(Mask programmed ROM)

利用掩模版，用光刻的方法把数据写入ROM。内容写入后无法修改  

(2) 可编程只读存储器PROM(Programmable ROM)

有二极管矩阵组成，写入时，利用外部引脚输入地址，对其中的二极管键进行选择，使其中的一些被烧断，另一些保持原状。  

写入后无法修改  

(3) 可擦除、可编程只读存储器 (Erasable programmable ROM) 

存储机制通过电荷的分布来实现信息的存储  

擦除:紫外光  

写入: 略  

(4) 可用电擦除的可编程只读存储器E^2PROM(Electrically erasable programmable ROM)  

特点: 可电擦除信息，而非紫外光照  

(5) 闪烁存储器(Flash memory)

特点:是E^2PROM 的一种，但是

速度快

容量大  

## 4.2 存储器的连接  

### 4.2.1 存储器和CPU的连接考虑  

![](pic/存储器和CPU的连接考虑.png)  

![](pic/存储器和CPU的连接考虑1.png)  

### 4.2.2 片选信号的产生方法  

![](pic/片选信号1.png)  

重叠的原因有的地址线未被使用  

![](pic/片选信号2.png)  

### 4.2.3 SRAM 和 DRAM 的连接举例  

![](pic/16KBSRAM子系统.png)  

![](pic/DRAM的举例.png)  

> 8286数据总线驱动器(总线收发器)  
>> Intel 8286 是8位三态双向缓冲器  

- 有8路双向缓冲电路，可实现8位数据的双向传送  

- 输出与输入同相  

![](pic/8286电路.png)  

允许引脚OE把 ：决定是否允许数据通过8286

发送引脚T: 控制数据的流向  

![](pic/与8086系统的连接.png)  

### 4.2.4 存储器的数据宽度扩充和字节数扩充  

![](pic/数据宽度扩充.png)  

## 4.3 微型计算机系统中存储器的体系结构  

### 4.3.1 层次化的存储器体系结构

1. 层次化总体结构

![](pic/层次化结构.png)  

![](pic/层次化总体结构.png)  

2. 内存的分区结构  
略  

### 4.3.2 微型计算机系统的内存组织  

1. 16位微机系统的内存组织  

![](pic/内存组织.png)  

![](pic/奇偶地址.png)  




















































